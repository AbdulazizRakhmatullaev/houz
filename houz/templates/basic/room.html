{% extends 'base.html' %}
{% load i18n %}

{% block title %} {{room.get_city_display}} ({{room.average_rating}}) {% endblock %}

{% block content %}
<form class="toprescol" action="{% url 'book_room' room.id %}" method="POST" onsubmit="submitForm(event)">
    {% csrf_token %}
    <button type="button" class="collapsible">
        <div class="lb" style="display: flex; flex-direction: column; align-items: self-start;">
            <span class="small-title">Reserve details</span>
        </div>
        <div class="rb">
            <svg class="arrow" xmlns="http://www.w3.org/2000/svg" width="16" height="12" fill="none" viewBox="0 0 16 12">
                <path fill="currentColor" d="M4.4544 3.691a.9.9 0 0 0-1.1087 1.418l4.0966 3.2033a.9.9 0 0 0 1.1085.0002l4.0999-3.2032a.9.9 0 1 0-1.1082-1.4185L7.9969 6.461l-3.5425-2.77Z"/>
            </svg >
        </div>
    </button>
    <div class="colpscol">
        <div class="colfl">
            <div class="gstsform">
                <span class="small-title">Adults</span>
                <div class="gstfl">
                    <span id="guestM_ph" class="minus">-</span>
                    <input type="text" id="adults_ph" value="0" disabled/>
                    <span id="guestP_ph" class="plus">+</span>
                </div>
            </div>
    
            <div class="gstsform">
                <span class="small-title">Children</span>
                <div class="gstfl">
                    <span id="childM_ph" class="minus">-</span>
                    <input type="text" id="children_ph" value="0" disabled/>
                    <span id="childP_ph" class="plus">+</span>
                </div>
            </div>
            <div class="gstsform">
                <span class="small-title">Infants</span>
                <div class="gstfl">
                    <span id="infantM_ph" class="minus">-</span>
                    <input type="text" id="infants_ph" value="0" disabled/>
                    <span id="infantP_ph" class="plus">+</span>
                </div>
            </div> 
            <div class="gstwinf">
                <div class="gstsform" {% if room.pets == 0 %}style="opacity: 0.4; pointer-events: none;"{% endif %}>
                    <span class="small-title">Pets {% if room.pets == 0 %} (not allowed) {% endif %}</span>
                    <div class="gstfl">
                        <span id="petM_ph" {% if room.pets == 0 %} class="disabled" {% endif %}>-</span>
                        <input type="text" id="pets_ph" value="0" disabled/>
                        <span id="petP_ph" {% if room.pets == 0 %} class="disabled" {% endif %}>+</span>
                    </div>
                </div>
            </div>
        </div> 
        <div class="rcrflex">
            <div class="check-io">
                <span class="small-title">Check-in</span>
                <div class="fl-spbn">
                    <input type="date" name="check_in_ph" value='{{room.check_in|date:"Y-m-d"}}' min='{{room.check_in|date:"Y-m-d"}}'
                        max='{{room.check_out|date:"Y-m-d"}}'>
                    <div class="chtm">
                        {{room.checkin_time|time:"H:i"}}
                        <span style="font-size: 10px;">{{room.checkin_time|time:"A"}}</span>
                    </div>
                </div>
            </div>
            <div class="check-io">
                <span class="small-title">Check-out</span>
                <div class="fl-spbn">
                    <input type="date" name="check_out_ph" value='{{room.check_out|date:"Y-m-d"}}' min='{{room.check_in|date:"Y-m-d"}}'
                        max='{{room.check_out|date:"Y-m-d"}}'>
                    <div class="chtm">
                        {{room.checkout_time|time:"H:i"}}
                        <span style="font-size: 10px;">{{room.checkin_time|time:"A"}}</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="hr"></div>
    </div>
    <div class="sticky-right-col">
        <div class="stfl">
            <div class="stlf">
                <div class="price-info">
                    {{currency}}<span id="total-price_ph" class="room-price">{{ room_tot_price }}</span>
                </div>
                <div class="hmadults" id="g_amt_ph">1</div>
            </div>
            <div class="strgt">
                <div class="pricing-col">
                    <div class="left-text">{{currency}}{{room_converted_price}} x <span id="num-nights_ph">{{room.num_o_days}}</span> nights
                    </div>
                    <div class="right-text">{{currency}}<span id="bynight-price_ph">{{room_count_nights_price}}</span></div>
                </div>
                <div class="pricing-col" style="margin-top: 13px;">
                    <div class="left-text">Houz fee</div>
                    <div class="right-text">{{currency}}<span id="houz-fee_ph">{{room_fee}}</span></div>
                </div>
            </div>
        </div>
        <div class="payment">
            <button class="btnbl" id="message-btn_ph">Reserve</button>
        </div>
        <div id="resinf"></div>
    </div>
</form >
<div class="room-title">
    <div class="brief-left-info">
        <div class="detailed-ci-cy">
            {{ room.city.name }}, {{room.country}}
        </div>
        <div class="brief-name">
            {{ room.title }}
        </div>
        <div class="howmany">
            {{room.how_many|safe}}
        </div>
    </div>
    <a href="#room-reviews-content" class="ratNrev">
        <div class="ratNrev-t">{{room.average_rating}} ({{room.rating_set.count}})</div>
        <div class="rnrstars">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" aria-hidden="true" role="presentation"
                focusable="false">
                <path fill-rule="evenodd"
                    d="m15.1 1.58-4.13 8.88-9.86 1.27a1 1 0 0 0-.54 1.74l7.3 6.57-1.97 9.85a1 1 0 0 0 1.48 1.06l8.62-5 8.63 5a1 1 0 0 0 1.48-1.06l-1.97-9.85 7.3-6.57a1 1 0 0 0-.55-1.73l-9.86-1.28-4.12-8.88a1 1 0 0 0-1.82 0z">
                </path>
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" aria-hidden="true" role="presentation"
                focusable="false">
                <path fill-rule="evenodd"
                    d="m15.1 1.58-4.13 8.88-9.86 1.27a1 1 0 0 0-.54 1.74l7.3 6.57-1.97 9.85a1 1 0 0 0 1.48 1.06l8.62-5 8.63 5a1 1 0 0 0 1.48-1.06l-1.97-9.85 7.3-6.57a1 1 0 0 0-.55-1.73l-9.86-1.28-4.12-8.88a1 1 0 0 0-1.82 0z">
                </path>
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" aria-hidden="true" role="presentation"
                focusable="false">
                <path fill-rule="evenodd"
                    d="m15.1 1.58-4.13 8.88-9.86 1.27a1 1 0 0 0-.54 1.74l7.3 6.57-1.97 9.85a1 1 0 0 0 1.48 1.06l8.62-5 8.63 5a1 1 0 0 0 1.48-1.06l-1.97-9.85 7.3-6.57a1 1 0 0 0-.55-1.73l-9.86-1.28-4.12-8.88a1 1 0 0 0-1.82 0z">
                </path>
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" aria-hidden="true" role="presentation"
                focusable="false">
                <path fill-rule="evenodd"
                    d="m15.1 1.58-4.13 8.88-9.86 1.27a1 1 0 0 0-.54 1.74l7.3 6.57-1.97 9.85a1 1 0 0 0 1.48 1.06l8.62-5 8.63 5a1 1 0 0 0 1.48-1.06l-1.97-9.85 7.3-6.57a1 1 0 0 0-.55-1.73l-9.86-1.28-4.12-8.88a1 1 0 0 0-1.82 0z">
                </path>
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" aria-hidden="true" role="presentation"
                focusable="false">
                <path fill-rule="evenodd"
                    d="m15.1 1.58-4.13 8.88-9.86 1.27a1 1 0 0 0-.54 1.74l7.3 6.57-1.97 9.85a1 1 0 0 0 1.48 1.06l8.62-5 8.63 5a1 1 0 0 0 1.48-1.06l-1.97-9.85 7.3-6.57a1 1 0 0 0-.55-1.73l-9.86-1.28-4.12-8.88a1 1 0 0 0-1.82 0z">
                </path>
            </svg>
        </div>
    </a>
</div>
<div class="rminfocol">
    <div class="left-info-column">
        <!-- Your HTML template -->
        <div id="myCarousel" class="carousel">
            <!-- Wrapper for slides -->
            <div class="carousel-inner">
                {% for photo in room.all_photos %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                    <img src="{{photo.file.url}}" alt="" class="each-image">
                </div>
                {% endfor %}
            </div>
            <!-- Left and right controls -->
            {% if room.all_photos|length > 1 %}
            <span class="carousel-control-prev" role="button" onclick="prevSlide()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36">
                    <path
                        d="M21.559,12.062 L15.618,17.984 L21.5221,23.944 C22.105,24.533 22.1021,25.482 21.5131,26.065 C21.2211,26.355 20.8391,26.4999987 20.4571,26.4999987 C20.0711,26.4999987 19.6851,26.352 19.3921,26.056 L12.4351,19.034 C11.8531,18.446 11.8551,17.4999987 12.4411,16.916 L19.4411,9.938 C20.0261,9.353 20.9781,9.354 21.5621,9.941 C22.1471,10.528 22.1451,11.478 21.5591,12.062 L21.559,12.062 Z">
                    </path>
                </svg>
            </span>
            <span class="carousel-control-next" role="button" onclick="nextSlide()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36">
                    <path
                        d="M23.5587,16.916 C24.1447,17.4999987 24.1467,18.446 23.5647,19.034 L16.6077,26.056 C16.3147,26.352 15.9287,26.4999987 15.5427,26.4999987 C15.1607,26.4999987 14.7787,26.355 14.4867,26.065 C13.8977,25.482 13.8947,24.533 14.4777,23.944 L20.3818,17.984 L14.4408,12.062 C13.8548,11.478 13.8528,10.5279 14.4378,9.941 C15.0218,9.354 15.9738,9.353 16.5588,9.938 L23.5588,16.916 L23.5587,16.916 Z">
                    </path>
                </svg>
            </span>
            {% endif %}
        </div>
        <div class="lbld">
            <div class="lbl0">Host</div>
            <div class="host-info">
                <a href="{% url 'user_profile' room.host.username %}">
                    {% if room.host.profile.avatar.url != null %}
                    <img src="{{room.host.profile.avatar.url}}" alt="" class="detpp">
                    {% else %}
                    <div class="detpp" style="background: linear-gradient({{room.host.profile.avatar_default}});">
                        <div class="detgrcn">
                            {{room.host.profile.name|slice:"0:1"}}
                        </div>
                    </div>
                    {% endif %}
                </a>
                <div class="n-d">
                    <a href="{% url 'user_profile' room.host.username %}" class="host-name">
                        {{room.host.profile.name}}
                    </a>
                    <div class="host-date">
                        Joined {{room.host.profile.created_at|date:"N Y"}}
                    </div>
                </div>
            </div>
        </div>
        <div class="lbld">
            <div class="lbl0">Description</div>
            <div class="desc">
                {% if room.get_desc|length < 1500 %}
                    {{room.get_desc}}
                {% else %}
                    {{room.get_desc|slice:":1500"}}...
                    <div class="btnsubstart" style="margin-top: 10px;">
                        <button class="btn-white">See more...</button>
                        <button class="btn-white">See more...</button>
                    </div>
                {% endif %}
            </div>
        </div>
        <div class="lbld">
            <div class="lbl0">Amenities</div>
            <div class="amenities-col">
                {% for amenity in room.amenities.all %}
                <div class="amenity">
                    {{amenity}}
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="lbld">
            <div class="lbl0">Ratings & Reviews</div>
            <div class="revsta">
                <div class="revlt">
                    <div class="revsta-t">{{room.average_rating}}</div>
                    <div class="tnrec">
                        <div class="revtxt">
                            {% if room.average_rating == 0 %}No reviews yet{% else %}Most helpful reviews{% endif %}
                        </div>
                        {% if room.average_rating >= 4.0 %}
                        <div class="spr">•</div>
                        <div class="revtxt">
                            People recommend this place!
                        </div>
                        {% endif %}
                    </div>
                </div>
                <div class="revrt">
                    <div class="rstars">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" aria-hidden="true" role="presentation"
                            focusable="false">
                            <path fill-rule="evenodd"
                                d="m15.1 1.58-4.13 8.88-9.86 1.27a1 1 0 0 0-.54 1.74l7.3 6.57-1.97 9.85a1 1 0 0 0 1.48 1.06l8.62-5 8.63 5a1 1 0 0 0 1.48-1.06l-1.97-9.85 7.3-6.57a1 1 0 0 0-.55-1.73l-9.86-1.28-4.12-8.88a1 1 0 0 0-1.82 0z">
                            </path>
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" aria-hidden="true" role="presentation"
                            focusable="false">
                            <path fill-rule="evenodd"
                                d="m15.1 1.58-4.13 8.88-9.86 1.27a1 1 0 0 0-.54 1.74l7.3 6.57-1.97 9.85a1 1 0 0 0 1.48 1.06l8.62-5 8.63 5a1 1 0 0 0 1.48-1.06l-1.97-9.85 7.3-6.57a1 1 0 0 0-.55-1.73l-9.86-1.28-4.12-8.88a1 1 0 0 0-1.82 0z">
                            </path>
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" aria-hidden="true" role="presentation"
                            focusable="false">
                            <path fill-rule="evenodd"
                                d="m15.1 1.58-4.13 8.88-9.86 1.27a1 1 0 0 0-.54 1.74l7.3 6.57-1.97 9.85a1 1 0 0 0 1.48 1.06l8.62-5 8.63 5a1 1 0 0 0 1.48-1.06l-1.97-9.85 7.3-6.57a1 1 0 0 0-.55-1.73l-9.86-1.28-4.12-8.88a1 1 0 0 0-1.82 0z">
                            </path>
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" aria-hidden="true" role="presentation"
                            focusable="false">
                            <path fill-rule="evenodd"
                                d="m15.1 1.58-4.13 8.88-9.86 1.27a1 1 0 0 0-.54 1.74l7.3 6.57-1.97 9.85a1 1 0 0 0 1.48 1.06l8.62-5 8.63 5a1 1 0 0 0 1.48-1.06l-1.97-9.85 7.3-6.57a1 1 0 0 0-.55-1.73l-9.86-1.28-4.12-8.88a1 1 0 0 0-1.82 0z">
                            </path>
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" aria-hidden="true" role="presentation"
                            focusable="false">
                            <path fill-rule="evenodd"
                                d="m15.1 1.58-4.13 8.88-9.86 1.27a1 1 0 0 0-.54 1.74l7.3 6.57-1.97 9.85a1 1 0 0 0 1.48 1.06l8.62-5 8.63 5a1 1 0 0 0 1.48-1.06l-1.97-9.85 7.3-6.57a1 1 0 0 0-.55-1.73l-9.86-1.28-4.12-8.88a1 1 0 0 0-1.82 0z">
                            </path>
                        </svg>
                    </div>
                    {% if room.rating_set.count > 0 %}
                    <div class="revtxt">
                        {{room.rating_set.count}} {% if room.rating_set.count == 1 %}Rating{% else %}Ratings{% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
            <div id="room-reviews-content">
                {% for review in reviews %}
                <div class="review">
                    <a href="{% url 'user_profile' review.user.username %}">
                        {% if review.user.profile.avatar.url != null %}
                        <img src="{{review.user.profile.avatar.url}}" alt="" class="pp">
                        {% else %}
                        <div class="pp" style="background: linear-gradient({{review.user.profile.avatar_default}});">
                            <div class="grcn">
                                {{review.user.profile.name|slice:"0:1"}}
                            </div>
                        </div>
                        {% endif %}
                    </a>
                    <div class="n-d">
                        <div class="n-stayed">
                            <a href="{% url 'user_profile' review.user.username %}"
                                class="reviewer-name">{{review.user.profile.name}}</a>
                            <div class="spr">•</div>
                            <div class="review-date">{{review.get_date}}</div>
                        </div>
                        <!--  -->
                        <div class="r-stars">
                            {{review.user_ratings|safe}}
                        </div>
                        <div class="review-text">
                            {% if review.review_text|length < 50 %}
                                {{review.review_text}}
                            {% else %}
                                {{review.review_text|slice:":120"}}...
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="lbld">
            <div class="lbl0">Where it's located</div>
            <div class="lbfl">
                <div class="collbsh" style="width: 100%;">
                    {{room.address}}, {{room.get_city_display}}, Uzbekistan
                </div>
                <button id="routeButton" class="shrt">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M16.777 3h1.419c.31 0 .596 0 .834.02.258.02.539.068.817.21.397.2.72.523.923.918.141.277.19.557.21.814.02.237.02.521.02.83V7.19c0 .31 0 .594-.02.831-.02.256-.069.537-.21.813a2.107 2.107 0 0 1-.923.92c-.278.14-.56.188-.817.21-.238.019-.524.019-.834.019h-1.419c-.31 0-.596 0-.834-.02a2.148 2.148 0 0 1-.817-.21 2.107 2.107 0 0 1-.923-.919 2.125 2.125 0 0 1-.21-.813 8.287 8.287 0 0 1-.02-.63l-2.198-.002c-.495-.001-.81 0-1.05.018-.23.019-.309.05-.343.067a.803.803 0 0 0-.352.35c-.017.034-.049.113-.068.341-.02.24-.02.554-.02 1.046v5.57c0 .49 0 .804.02 1.043.019.228.05.306.068.34.077.15.2.273.35.35.035.017.113.049.342.067.24.02.555.021 1.048.022l2.203.003a7.95 7.95 0 0 1 .02-.627c.02-.256.069-.537.21-.813.203-.396.526-.718.923-.92.278-.14.56-.189.817-.21.238-.019.524-.019.834-.019h1.419c.31 0 .596 0 .834.02.258.02.539.068.817.21.397.201.72.523.923.919.141.276.19.557.21.813.02.237.02.522.02.831v1.397c0 .31 0 .594-.02.831-.02.256-.069.537-.21.814a2.108 2.108 0 0 1-.923.919c-.278.14-.56.189-.817.21-.238.019-.524.019-.834.019h-1.419c-.31 0-.596 0-.834-.02a2.148 2.148 0 0 1-.817-.21 2.108 2.108 0 0 1-.923-.918 2.125 2.125 0 0 1-.21-.814 8.288 8.288 0 0 1-.02-.63l-2.24-.002c-.449 0-.839-.001-1.16-.028-.341-.028-.684-.09-1.016-.259a2.61 2.61 0 0 1-1.14-1.137c-.17-.33-.231-.672-.259-1.011-.026-.321-.026-.71-.026-1.156v-1.921H2.905A.903.903 0 0 1 2 11.992c0-.498.405-.901.905-.901h5.227V9.177c0-.448 0-.837.026-1.159.028-.34.09-.682.26-1.013a2.61 2.61 0 0 1 1.144-1.138c.332-.168.676-.23 1.017-.257.323-.025.714-.025 1.164-.024l2.23.003a7.95 7.95 0 0 1 .02-.627c.02-.257.069-.537.21-.814.203-.395.526-.717.923-.919.278-.14.56-.189.817-.21C16.18 3 16.467 3 16.777 3Z" clip-rule="evenodd"/></svg>
                    Show Route
                </button>
            </div>
            
            <input type="hidden" id="latitude" name="latitude" value="{{room.fst_loc}}">
            <input type="hidden" id="longitude" name="longitude" value="{{room.sec_loc}}">
            <div id="room_map" class="room-location"></div>
        </div>
        <div class="lbld">
            <div class="lbl0">House rules</div>
            <div class="hrule-col">
                <div class="hrule">
                    Check-in: {{room.checkin_time|time:"H:i A"}}
                </div>
                <div class="hrule">
                    Check-out: {{room.checkout_time|time:"H:i A"}}
                </div>
                {% for rule in room.house_rules.all %}
                <div class="hrule">
                    {{rule}}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <form class="right-info-column" id="reserve-form" action="{% url 'book_room' room.id %}" method="POST" onsubmit="submitForm(event)">
        {% csrf_token %}
        <div class="htxt">How many guests are there</div>
        <button type="button" class="collapsible">
            <div class="lb" style="display: flex; flex-direction: column; align-items: self-start;">
                <span class="small-title">Guests</span>
                <div class="hmadults" id="g_amt">1</div>
            </div>
            <div class="rb">
                <svg class="arrow" xmlns="http://www.w3.org/2000/svg" width="16" height="12" fill="none" viewBox="0 0 16 12">
                    <path fill="currentColor" d="M4.4544 3.691a.9.9 0 0 0-1.1087 1.418l4.0966 3.2033a.9.9 0 0 0 1.1085.0002l4.0999-3.2032a.9.9 0 1 0-1.1082-1.4185L7.9969 6.461l-3.5425-2.77Z"/>
                </svg >
            </div>
        </button>
        <div class="colpscol">
            <div class="gstwinf">
                <div class="gstsform">
                    <span class="small-title">Adults</span>
                    <div class="gstfl">
                        <span id="guestM" class="minus">-</span>
                        <input type="text" id="adults" value="1" disabled/>
                        <span id="guestP" class="plus">+</span>
                    </div>
                </div>
                <div id="ginfo"></div>
            </div>

            <div class="gstsform">
                <span class="small-title">Children</span>
                <div class="gstfl">
                    <span id="childM" class="minus">-</span>
                    <input type="text" id="children" value="0" disabled/>
                    <span id="childP" class="plus">+</span>
                </div>
            </div>
            <div class="gstsform">
                <span class="small-title">Infants</span>
                <div class="gstfl">
                    <span id="infantM" class="minus">-</span>
                    <input type="text" id="infants" value="0" disabled/>
                    <span id="infantP_ph" class="plus">+</span>
                </div>
            </div>  
            <div class="gstwinf">
                <div class="gstsform" {% if room.pets == 0 %}style="opacity: 0.4; pointer-events: none;"{% endif %}>
                    <span class="small-title">Pets {% if room.pets == 0 %} (not allowed) {% endif %}</span>
                    <div class="gstfl">
                        <span id="petM" {% if room.pets == 0 %} class="disabled" {% endif %}>-</span>
                        <input type="text" id="pets" value="0" disabled/>
                        <span id="petP" {% if room.pets == 0 %} class="disabled" {% endif %}>+</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="ahr15"></div>
        <div class="htxt">When you want to stay</div>
        <div class="rcrflex" style="margin-top: 13px; flex-direction: column;">
            <div class="check-io">
                <span class="small-title">Check-in</span>
                <div class="fl-spbn">
                    <input type="date" name="check_in" value='{{room.check_in|date:"Y-m-d"}}' min='{{room.check_in|date:"Y-m-d"}}'
                        max='{{room.check_out|date:"Y-m-d"}}'>
                    <div class="chtm">{{room.checkin_time|time:"H:i A"}}</div>
                </div>
            </div>
            <div class="check-io">
                <span class="small-title">Check-out</span>
                <div class="fl-spbn">
                    <input type="date" name="check_out" value='{{room.check_out|date:"Y-m-d"}}' min='{{room.check_in|date:"Y-m-d"}}'
                        max='{{room.check_out|date:"Y-m-d"}}'>
                    <div class="chtm">{{room.checkout_time|time:"H:i A"}}</div>
                </div>
            </div>
        </div>
        {% if room.num_o_days > 2 %}
        <div class="dayfls">
            <div class="dfl" data-days="1">1 night</div>
            {% if room.num_o_days >= 3 %}
            <div class="dfl" data-days="3">3 nights</div>
            {% endif %}
            {% if room.num_o_days >= 7 %}
            <div class="dfl" data-days="7">7 nights</div>
            {% endif %}
            {% if room.num_o_days >= 14 %}
            <div class="dfl" data-days="14">14 nights</div>
            {% endif %}
        </div>
        {% endif %}
        <div class="sticky-right-col">
            <div class="price-info">
                {{currency}}<span id="total-price" class="room-price">{{ room_tot_price }}</span>
            </div>
            <div class="actualprice">{{currency}}<span id="actual-price">{{room_converted_price}}</span>/night</div>
            <div class="ahr"></div>
            <div class="pricing-col">
                <div class="left-text">{{currency}}{{room_converted_price}} x <span id="num-nights">{{room.num_o_days}}</span> nights
                </div>
                <div class="right-text">{{currency}}<span id="bynight-price">{{room_count_nights_price}}</span></div>
            </div>
            <div class="pricing-col" style="margin-top: 13px;">
                <div class="left-text">Houz fee</div>
                <div class="right-text">{{currency}}<span id="houz-fee">{{room_fee}}</span></div>
            </div>
            <div class="payment">
                <button class="btnbl" id="message-btn">Reserve</button>
            </div>
            <div id="resinf"></div>
        </div>
    </form >
</div>

<div class="roomrecs">
    <div class="botmaint">There's always more to explore.</div>
    <div id="room-container">
        {% include 'temps/room_list.html' %}
    </div>
</div>

{% endblock %}

{% block footer %}
{% endblock %}

{% block scripts %}
<script>
    function submitForm(event) {
        event.preventDefault(); // Prevent the default form submission

        const guests = parseInt(document.getElementById('g_amt').textContent);

        const formData = new FormData(document.getElementById('reserve-form'));

        fetch("{% url 'book_room' room.id %}", {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            }
        }).then(response => {
            if (response.ok) {
                response.json().then(data => {
                    window.location.href = `/rooms/${data.room_id}`;
                });
            } else {
                document.getElementById('resinf').textContent = '{% trans "Error processing the request" %}';
            }
        }).catch(error => {
            document.getElementById('resinf').textContent = '{% trans "Error processing the request" %}';
        });
    }
</script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    var coll = document.getElementsByClassName("collapsible");

    for (var i = 0; i < coll.length; i++) {
      coll[i].addEventListener("click", function() {
        this.classList.toggle("active");
        var content = this.nextElementSibling;
        if (content.style.display === "flex") {
          content.style.display = "none";
        } else {
          content.style.display = "flex";
        }
      });
    }
  });
</script>

<script>
    $(document).ready(function () {
        function updateTotalPets() {
            const adults = parseInt($('#adults').val());
            const children = parseInt($('#children').val());
            const infants = parseInt($('#infants').val());
            const pets = parseInt($('#pets').val());
            const totalGuests = adults + children + infants;
            
            if (pets > 0) {
                $('#g_amt').text(`${totalGuests} (${pets} Pet${pets > 1 ? 's' : ''})`);
            } else {
                $('#g_amt').text(totalGuests);
            }
    
            // Disable the plus button if total pets reach the max limit
            if (pets >= {{room.pets}}) {
                $('#petP').addClass('disabled');
            } else {
                $('#petP').removeClass('disabled');
            }

            // Disable the minus button if pets are at the minimum limit
            if (pets <= 0) {
                $('#petM').addClass('disabled');
            } else {
                $('#petM').removeClass('disabled');
            }
        }
        
        function updatePetInp($input, increment) {
            const currentCount = parseInt($input.val());
            let newCount = currentCount + increment;
            newCount = Math.max(0, Math.min(newCount, {{room.pets}})); // Ensure newCount is within 0 and max pets limit
    
            $input.val(newCount);
            $input.change();
            
            updateTotalPets();
        }
        
        $('#petP').click(function () {
            if ($(this).hasClass('disabled')) return false;
            
            const $input = $(this).parent().find('input');
            updatePetInp($input, 1);
            return false;
        });
    
        $('#petM').click(function () {
            if ($(this).hasClass('disabled')) return false;
    
            const $input = $(this).parent().find('input');
            updatePetInp($input, -1);
            return false;
        });
        
        // Initial call to set the state of the buttons
        updateTotalPets();
    });
</script>

<script>
    $(document).ready(function () {
        const maxGuests = {{room.guests}}; // Define the maximum number of guests

        function updateTotalGuests() {
            const adults = parseInt($('#adults').val());
            const children = parseInt($('#children').val());
            const infants = parseInt($('#infants').val());
            const totalGuests = adults + children + infants;

            const pets = parseInt($('#pets').val());

            if (pets > 0) {
                $('#g_amt').text(`${totalGuests} (${pets} Pet${pets > 1 ? 's' : ''})`);
            } else {
                $('#g_amt').text(totalGuests);
            }

            // Disable the plus buttons if total guests reach the max limit
            if (totalGuests >= maxGuests) {
                $('.plus').addClass('disabled');
            } else {
                $('.plus').removeClass('disabled');
            }

            // Enable or disable the minus buttons based on the count
            updateButtonState();
        }

        function updateInputs($input, increment) {
            const id = $input.attr('id');
            const maxCount = parseInt(id === 'adults' ? {{room.adults}} : id === 'children' ? {{room.children}} : id === 'infants' ? {{room.infants}} : 99);
            const currentCount = parseInt($input.val());
            let newCount = currentCount + increment;
            newCount = Math.max(id === 'adults' ? 1 : 0, Math.min(newCount, maxCount)); // Ensure newCount is within the proper range

            const totalGuests = parseInt($('#g_amt').text());

            if (totalGuests + increment > maxGuests && increment > 0) {
                return;
            }

            $input.val(newCount);
            $input.change();

            updateTotalGuests();
        }

        function updateButtonState() {
            const adults = parseInt($('#adults').val());

            $('.gstfl').each(function () {
                const $input = $(this).find('input');
                const count = parseInt($input.val());
                const totalGuests = parseInt($('#g_amt').text());
                const id = $input.attr('id');
                const maxCount = parseInt(id === 'adults' ? {{room.adults}} : id === 'children' ? {{room.children}} : id === 'infants' ? {{room.infants}} : 99);

                if ($input.attr('id') === 'adults') {
                    if (adults <= 1) {
                        $(this).find('.minus').addClass('disabled');
                    } else {
                        $(this).find('.minus').removeClass('disabled');
                    }
                } else {
                    if (count <= 0) {
                        $(this).find('.minus').addClass('disabled');
                    } else {
                        $(this).find('.minus').removeClass('disabled');
                    }
                }

                if (count >= maxCount) {
                    $(this).find('.plus').addClass('disabled');
                } else {
                    $(this).find('.plus').removeClass('disabled');
                }
            });

            if ($('#pets').val() <= {{room.pets}}) {
                $('#petP').removeClass('disabled');
            }
        }

        function resetValues() {
            $('#children').val(0);
            $('#infants').val(0);
        }

        $('.plus').click(function () {
            if ($(this).hasClass('disabled')) return false;

            const $input = $(this).parent().find('input');
            updateInputs($input, 1);
            return false;
        });

        $('.minus').click(function () {
            if ($(this).hasClass('disabled')) return false;

            const $input = $(this).parent().find('input');
            updateInputs($input, -1);
            return false;
        });

        updateTotalGuests();
    });
</script>

<script>
    $(document).ready(function () {
        const maxGuests = {{room.guests}}; // Define the maximum number of guests

        function updateTotalGuests() {
            const adults = parseInt($('#adults_ph').val());
            const children = parseInt($('#children_ph').val());
            const infants = parseInt($('#infants_ph').val());
            const totalGuests = adults + children + infants;

            const pets = parseInt($('#pets_ph').val());

            if (pets > 0) {
                $('#g_amt_ph').text(`${totalGuests} (${pets} Pet${pets > 1 ? 's' : ''})`);
            } else {
                $('#g_amt_ph').text(totalGuests);
            }

            // Disable the plus buttons if total guests reach the max limit
            if (totalGuests >= maxGuests) {
                $('.plus').addClass('disabled');
            } else {
                $('.plus').removeClass('disabled');
            }

            // Enable or disable the minus buttons based on the count
            updateButtonState();
        }

        function updateInputs($input, increment) {
            const id = $input.attr('id');
            const maxCount = parseInt(id === 'adults_ph' ? {{room.adults}} : id === 'children_ph' ? {{room.children}} : id === 'infants_ph' ? {{room.infants}} : 99);
            const currentCount = parseInt($input.val());
            let newCount = currentCount + increment;
            newCount = Math.max(id === 'adults_ph' ? 1 : 0, Math.min(newCount, maxCount)); // Ensure newCount is within the proper range

            const totalGuests = parseInt($('#g_amt_ph').text());

            if (totalGuests + increment > maxGuests && increment > 0) {
                return;
            }

            $input.val(newCount);
            $input.change();

            updateTotalGuests();
        }

        function updateButtonState() {
            const adults = parseInt($('#adults_ph').val());

            $('.gstfl').each(function () {
                const $input = $(this).find('input');
                const count = parseInt($input.val());
                const totalGuests = parseInt($('#g_amt_ph').text());
                const id = $input.attr('id');
                const maxCount = parseInt(id === 'adults_ph' ? {{room.adults}} : id === 'children_ph' ? {{room.children}} : id === 'infants_ph' ? {{room.infants}} : 99);

                if ($input.attr('id') === 'adults_ph') {
                    if (adults <= 1) {
                        $(this).find('.minus').addClass('disabled');
                    } else {
                        $(this).find('.minus').removeClass('disabled');
                    }
                } else {
                    if (count <= 0) {
                        $(this).find('.minus').addClass('disabled');
                    } else {
                        $(this).find('.minus').removeClass('disabled');
                    }
                }

                if (count >= maxCount) {
                    $(this).find('.plus').addClass('disabled');
                } else {
                    $(this).find('.plus').removeClass('disabled');
                }
            });

            if ($('#pets_ph').val() <= {{room.pets}}) {
                $('#petP_ph').removeClass('disabled');
            }
        }

        function resetValues() {
            $('#children_ph').val(0);
            $('#infants_ph').val(0);
        }

        $('.plus').click(function () {
            if ($(this).hasClass('disabled')) return false;

            const $input = $(this).parent().find('input');
            updateInputs($input, 1);
            return false;
        });

        $('.minus').click(function () {
            if ($(this).hasClass('disabled')) return false;

            const $input = $(this).parent().find('input');
            updateInputs($input, -1);
            return false;
        });

        updateTotalGuests();
    });
</script>

<script>
    // Helper function to calculate date difference in days
    function dateDiffInDays(date1, date2) {
        const diffTime = Math.abs(date2 - date1);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return diffDays;
    }

    // Helper function to format date as "YYYY-MM-DD"
    function formatDate(date) {
        const year = date.getFullYear();
        let month = date.getMonth() + 1;
        if (month < 10) {
            month = '0' + month;
        }
        let day = date.getDate();
        if (day < 10) {
            day = '0' + day;
        }
        return `${year}-${month}-${day}`;
    }

    // Function to format price based on currency
    function formatPrice(value) {
        const noDecimalCurrencies = ["UZS", "JPY", "CNY", "RUB"];
        const currency = "{{ request.currency }}";
        if (noDecimalCurrencies.includes(currency)) {
            return Math.floor(value).toLocaleString();
        } else {
            return value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }
    }

    // Update prices and min/max attributes based on date input changes with animation
    function updatePrices() {
        const checkInInput = document.querySelector('input[name="check_in"]');
        const checkOutInput = document.querySelector('input[name="check_out"]');
        const checkInDate = new Date(checkInInput.value);
        const checkOutDate = new Date(checkOutInput.value);
        const actualPrice = parseFloat(document.getElementById('actual-price').textContent.replace(/,/g, ''));

        if (checkInDate && !isNaN(checkInDate.getTime())) {
            // Set check-out minimum date to the day after check-in
            const nextDay = new Date(checkInDate);
            nextDay.setDate(nextDay.getDate() + 1);
            checkOutInput.min = formatDate(nextDay);
        }

        if (checkOutDate && !isNaN(checkOutDate.getTime())) {
            // Set check-in maximum date to the day before check-out
            const prevDay = new Date(checkOutDate);
            prevDay.setDate(prevDay.getDate() - 1);
            checkInInput.max = formatDate(prevDay);
        }

        if (checkInDate && checkOutDate && checkOutDate > checkInDate) {
            const numNights = dateDiffInDays(checkInDate, checkOutDate);
            const bynightPrice = actualPrice * numNights;
            const fee = 0.33 * bynightPrice;
            const totalPrice = fee + bynightPrice;

            const numNightsElement = document.getElementById('num-nights');
            const bynightElement = document.getElementById('bynight-price');
            const totalPriceElement = document.getElementById('total-price');
            const feeElement = document.getElementById('houz-fee');

            function animateValue(element, start, end, duration, isInteger) {
                let startTimestamp = null;
                const step = (timestamp) => {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    const currentValue = progress * (end - start) + start;
                    element.textContent = isInteger ? Math.floor(currentValue).toLocaleString() : formatPrice(currentValue);
                    if (progress < 1) {
                        window.requestAnimationFrame(step);
                    }
                };
                window.requestAnimationFrame(step);
            }

            animateValue(numNightsElement, parseInt(numNightsElement.textContent), numNights, 800, true);
            animateValue(totalPriceElement, parseFloat(totalPriceElement.textContent.replace(/,/g, '')), totalPrice, 500, false);
            animateValue(bynightElement, parseFloat(bynightElement.textContent.replace(/,/g, '')), bynightPrice, 500, false);
            animateValue(feeElement, parseFloat(feeElement.textContent.replace(/,/g, '')), fee, 500, false);
        }
    }

    // Function to handle day filter click
    function handleDayFilterClick(event) {
        const days = parseInt(event.target.getAttribute('data-days'));
        const checkInInput = document.querySelector('input[name="check_in"]');
        const checkOutInput = document.querySelector('input[name="check_out"]');
        const checkInDate = new Date(checkInInput.value);

        // Calculate the new check-out date based on the selected day filter
        const checkOutDate = new Date(checkInDate);
        checkOutDate.setDate(checkOutDate.getDate() + days);

        // Set the new dates for the check-in and check-out inputs
        checkInInput.value = formatDate(checkInDate);
        checkOutInput.value = formatDate(checkOutDate);

        // Call updatePrices to update the prices accordingly
        updatePrices();
    }

    // Add event listeners to the day filter elements
    document.querySelectorAll('.dfl').forEach(function(element) {
        element.addEventListener('click', handleDayFilterClick);
    });

    // Add event listeners to date inputs
    document.querySelector('input[name="check_in"]').addEventListener('change', updatePrices);
    document.querySelector('input[name="check_out"]').addEventListener('change', updatePrices);

    // Initial call to update prices on page load
    updatePrices();
</script>

<script>
    function checkOnlineStatus() {
        return window.navigator.onLine;
    }

    function initializeMap() {
        document.getElementById("room_map").textContent = "";
        mapboxgl.accessToken = 'pk.eyJ1IjoiY3JhY2tlZHBvb2wiLCJhIjoiY2x2YmZ4cHdzMDg3NDJpcDF2MHc4emkyYSJ9.BsOd8E2wuYCPzUMaNOsqBg';

        var initialLatitude = parseFloat(document.getElementById('latitude').value);
        var initialLongitude = parseFloat(document.getElementById('longitude').value);

        // Initialize the map
        var room_map = new mapboxgl.Map({
            container: 'room_map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [initialLongitude, initialLatitude], // Tashkent, Uzbekistan
            zoom: 14.5
        });

        // Add zoom and unzoom controls
        room_map.addControl(new mapboxgl.NavigationControl());
        room_map.addControl(new mapboxgl.FullscreenControl());

        // Create marker
        var marker = new mapboxgl.Marker({
            draggable: false
        }).setLngLat([initialLongitude, initialLatitude]).addTo(room_map);

        // Add routing control
        room_map.addControl(
            new MapboxDirections({
                accessToken: mapboxgl.accessToken
            }),
            'top-left'
        );

        // Route button functionality
        document.getElementById('routeButton').addEventListener('click', function () {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var userLocation = [position.coords.longitude, position.coords.latitude];
                    var roomLocation = [initialLongitude, initialLatitude];
                    
                    var directions = new MapboxDirections({
                        accessToken: mapboxgl.accessToken
                    });

                    room_map.addControl(directions, 'bottom-left');

                    directions.setOrigin(userLocation);
                    directions.setDestination(roomLocation);
                }, function (error) {
                    alert('Error occurred. Error code: ' + error.code);
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        });
    }

    function displayOfflineMessage() {
        const mapcon = document.getElementById("room_map");
        mapcon.textContent = "No internet connection. Unable to load the map";
    }

    // Initial check for online status
    if (!checkOnlineStatus()) {
        displayOfflineMessage();
    } else {
        initializeMap();
    }

    // Event listeners for online/offline status changes
    window.addEventListener('online', () => {
        initializeMap(); // Re-initialize the map or other functionality as needed
    });

    window.addEventListener('offline', () => {
        displayOfflineMessage();
    });
</script>

<script>
    let currentSlide = 0;
    const slides = document.querySelectorAll('.carousel-item');
    const totalSlides = slides.length;
    const prevArrow = document.querySelector('.carousel-control-prev');
    const nextArrow = document.querySelector('.carousel-control-next');

    function showSlide(index) {
        slides[currentSlide].classList.remove('active');
        slides[index].classList.add('active');
        currentSlide = index;
        updateCarouselPosition();
        updateArrowVisibility();
    }

    function prevSlide() {
        let index = (currentSlide - 1 + totalSlides) % totalSlides;
        showSlide(index);
    }

    function nextSlide() {
        let index = (currentSlide + 1) % totalSlides;
        showSlide(index);
    }

    function updateCarouselPosition() {
        const position = -currentSlide * 100;
        document.querySelector('.carousel-inner').style.transform = `translateX(${position}%)`;
    }

    function updateArrowVisibility() {
        if (currentSlide === 0) {
            prevArrow.style.display = 'none'; // Hide previous arrow when on the first slide
        } else {
            prevArrow.style.display = 'grid'; // Show previous arrow otherwise
        }
        if (currentSlide === totalSlides - 1) {
            nextArrow.style.display = 'none'; // Hide next arrow when on the last slide
        } else {
            nextArrow.style.display = 'grid'; // Show next arrow otherwise
        }
    }

    // Call updateArrowVisibility() once the page loads
    document.addEventListener("DOMContentLoaded", function () {
        updateArrowVisibility();
    });
</script>
{% endblock %}
